# Example Kubernetes secrets for IDM service
# Copy this file and update with your actual values
# Apply with: kubectl apply -f k8s/secrets.yaml

apiVersion: v1
kind: Secret
metadata:
  name: idm-secrets
  namespace: prasuti-ai
type: Opaque
data:
  # Database connection string (base64 encoded)
  # Example: postgres://user:password@postgres:5432/idm
  database-url: cG9zdGdyZXM6Ly91c2VyOnBhc3N3b3JkQHBvc3RncmVzOjU0MzIvaWRt

  # Encryption master key for encrypting sensitive data (32 characters minimum)
  # Generate with: openssl rand -base64 32
  encryption-master-key: Y2hhbmdlLW1lLWluLXByb2R1Y3Rpb24tMzItY2hhcnM=

  # Session secret for express sessions
  # Generate with: openssl rand -base64 64
  session-secret: Y2hhbmdlLW1lLWluLXByb2R1Y3Rpb24tc2Vzc2lvbi1zZWNyZXQ=

  # Redis connection URL
  # Example: redis://user:password@redis:6379
  redis-url: cmVkaXM6Ly91c2VyOnBhc3N3b3JkQHJlZGlzOjYzNzk=

  # Email SMTP configuration
  smtp-host: c210cC5leGFtcGxlLmNvbQ==  # smtp.example.com
  smtp-port: NTg3  # 587
  smtp-user: bm90aWZpY2F0aW9uc0BwcmFzdXRpLmFp  # notifications@prasuti.ai
  smtp-password: eW91ci1zbXRwLXBhc3N3b3Jk  # your-smtp-password

  # OAuth providers (if using social login)
  google-client-id: eW91ci1nb29nbGUtY2xpZW50LWlk
  google-client-secret: eW91ci1nb29nbGUtY2xpZW50LXNlY3JldA==

  # API keys for external services
  sendgrid-api-key: eW91ci1zZW5kZ3JpZC1hcGkta2V5
  twilio-account-sid: eW91ci10d2lsaW8tYWNjb3VudC1zaWQ=
  twilio-auth-token: eW91ci10d2lsaW8tYXV0aC10b2tlbg==

---
# TLS certificate secret (if using cert-manager)
apiVersion: v1
kind: Secret
metadata:
  name: idm-tls-secret
  namespace: prasuti-ai
type: kubernetes.io/tls
data:
  # These will be automatically populated by cert-manager
  tls.crt: LS0tLS1CRUdJTi...  # Your TLS certificate
  tls.key: LS0tLS1CRUdJTi...  # Your TLS private key

---
# Configuration for JWT signing keys
apiVersion: v1
kind: Secret
metadata:
  name: idm-jwt-keys
  namespace: prasuti-ai
type: Opaque
data:
  # Initial JWT signing key pair (generate with scripts/rotate-keys.ts)
  # Private key (encrypted)
  jwt-private-key: LS0tLS1CRUdJTi...
  # Public key
  jwt-public-key: LS0tLS1CRUdJTi...
  # Key ID
  jwt-key-id: a2V5LTIwMjUtMDEtMDE=

---
# Example ConfigMap for non-sensitive configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: idm-config
  namespace: prasuti-ai
data:
  # Application configuration
  node-env: "production"
  jwt-issuer: "https://idm.prasuti.ai"
  jwt-audience: "prasuti-services"
  jwt-access-ttl: "15m"
  jwt-refresh-ttl: "30d"
  mfa-issuer: "Prasuti.AI Hub"
  
  # Feature flags
  prometheus-enabled: "true"
  consul-enabled: "true"
  email-verification-required: "true"
  mfa-required-for-admins: "true"
  
  # Rate limiting
  rate-limit-login: "5"
  rate-limit-window: "15"
  rate-limit-register: "3"
  
  # Security settings
  password-min-length: "8"
  password-require-special: "true"
  session-timeout: "24h"
  max-login-attempts: "5"
  lockout-duration: "30m"

---
# Instructions for generating secrets:
#
# 1. Database URL:
#    echo -n "postgres://idm_user:your_password@postgres.example.com:5432/idm" | base64
#
# 2. Encryption Master Key (32+ characters):
#    openssl rand -base64 32 | tr -d '\n' | base64
#
# 3. Session Secret:
#    openssl rand -base64 64 | tr -d '\n' | base64
#
# 4. JWT Key Pair:
#    Use the scripts/rotate-keys.ts script to generate initial keys
#
# 5. Apply secrets:
#    kubectl apply -f k8s/secrets.yaml
#
# 6. Verify secrets:
#    kubectl get secrets -n prasuti-ai
#    kubectl describe secret idm-secrets -n prasuti-ai
#
# Security Notes:
# - Never commit actual secrets to version control
# - Use a secrets management system like Vault or AWS Secrets Manager in production
# - Regularly rotate all secrets and keys
# - Monitor access to secrets with audit logging
# - Use service accounts with minimal required permissions
